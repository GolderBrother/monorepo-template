# monorepo-template

[![Build](https://github.com/mrcointreau/npm-packages-monorepo-template/actions/workflows/build.yaml/badge.svg)](https://github.com/mrcointreau/npm-packages-monorepo-template/actions/workflows/build.yaml)

This repository serves as a template for managing a monorepo containing npm packages. It is specifically designed to facilitate the development of TypeScript-based npm packages that share a common core package. By utilizing pnpm for package management and turbo for project building, you can optimize your workflow and enhance the efficiency of your development process.

## Packages

This monorepo includes the following packages:

- `core`: A foundational package that is used by other packages in this monorepo.
- `package1`: An npm package that depends on `core`.
- `package2`: Another npm package that also depends on `core`.

Each package is configured with TypeScript and includes a Rollup build setup to create distributable artifacts.

## Features

- **ESLint Configuration**: Includes `plugin:@typescript-eslint/recommended` for consistent TypeScript linting.
- **TypeScript Configuration**: Centralized tsconfig for consistent TypeScript compilation settings.
- **Rollup Build**: Each package is equipped with a Rollup build configuration to create the `dist` directory for publishing.
- **Automated Release Workflow**: Utilizes GitHub Actions for CI/CD to automate the release process.

## Getting Started

To get started with this monorepo, clone the repository and install dependencies:

```bash
git clone https://github.com/GolderBrother/monorepo-template
cd monorepo-template
npm install
```

## Install

```
npm i xxx -g
```

### Working with Packages

You can work on each package individually. Navigate to the package directory and start developing:

```bash
cd packages/package1
# work on package1
```

### Update Packages

Each package can be auto update

The npm run commit command in this project performs the following actions:

- pnpm changeset: Runs the changeset tool, which generates or updates a change set for the project. A change set is a file containing information about the changes made to the project, often used for version control and release management.

- pnpm run version-packages: Runs the version-packages script, which uses the change set generated by changeset to update the project's version numbers. This typically involves modifying the package.json files to reflect the new version numbers.

- cz: Runs commitizen (via its CLI tool cz), a command-line tool that replaces the traditional git commit command. It guides users through an interactive interface to enter commit messages, ensuring that they follow a specified format and convention. This helps maintain clear and consistent commit messages.

In summary, the npm run commit command performs the following steps in the project, run:

```bash
npm run commit
```

### Building Packages

Each package can be built using Vite(Rollup). From within a package's directory, run:

```bash
npm run build
```

This command will compile the TypeScript source and create a `dist` folder with the build artifacts.

## Releasing Packages

To release a package, follow these steps:

1. **Create a Release Branch**: Create and switch to a release branch named `release-[package_name]`:

   ```bash
   git checkout -b release-package1
   ```

2. **Push to GitHub**: Push the branch to GitHub:

   ```bash
   git push origin release-package1
   ```

3. **Trigger the Release CI**: The push will trigger the release CI GitHub workflow, which will build, version, and publish your package to the npm registry.

4. **Merge the Branch**: After the release CI workflow has successfully completed, it will update the `package.json` and `CHANGELOG.md` in the package folder. You should then merge the release branch back into your main branch:

   ```bash
   git checkout main
   git merge release-package1
   npm run commit
   npm run release
   git push origin main
   ```

This process ensures that your package is versioned, built, and published automatically, while also keeping your repository's main branch up-to-date with the latest changes.

## LICENSE

[MIT](./LICENSE)
